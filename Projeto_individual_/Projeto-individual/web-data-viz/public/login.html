<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Login | Castelo Infinito</title>
    <link rel="stylesheet" href="css/login.css">
</head>

<body 
    style="background: url('../public/css/imagens_videos_Sitee/castelo_infinito.jpeg') no-repeat center center fixed; background-size: cover;">
    <div class="login-container">
        <h1 class="login-title">Bem-vindo de volta!</h1>
        <div class="login-box">

            <label for="ipt_email">Email</label>
            <input id="ipt_email" type="email" placeholder="email@exemplo.com">

            <label for="ipt_senha">Senha</label>
            <input id="ipt_senha" type="password" placeholder="Sua senha">

            <button class="btn-login" onclick="entrar()">Entrar</button>

            <p class="cadastro-link">Ainda não tem conta? <a href="cadastro.html">Cadastre-se</a></p>
            <div id="cardErro" class="mensagem" style="display:none"></div>
        </div>
    </div>

    <script>
        function sumirMensagem() {
            const card = document.getElementById('cardErro');
            card.style.display = 'none';
            card.innerText = '';
        }

        function entrar() {
            const email = document.getElementById('ipt_email').value.trim();
            const senha = document.getElementById('ipt_senha').value;
            const card = document.getElementById('cardErro');

            card.style.display = 'none';
            if (!email || !senha) {
                card.style.display = 'block';
                card.style.color = 'red';
                card.innerText = 'Preencha email e senha.';
                return;
            }

            fetch('/usuarios/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: email, senha: senha })
            })
                .then(async res => {
                    if (res.ok) {
                        const usuario = await res.json();
                        sessionStorage.ID_USUARIO = usuario.idUsuario || usuario.id || usuario.idusuario;
                        sessionStorage.NOME_USUARIO = usuario.nome;
                        sessionStorage.EMAIL_USUARIO = usuario.email;
                        window.location.href = "./dashboard/area-usuario.html";
                    } else {
                        const texto = await res.text().catch(() => null);
                        card.style.display = 'block';
                        card.style.color = 'red';
                        card.innerText = texto || 'Email e/ou senha inválidos.';
                    }
                })
                .catch(err => {
                    console.error(err);
                    card.style.display = 'block';
                    card.style.color = 'red';
                    card.innerText = 'Erro na comunicação com o servidor. Certifique-se de abrir via http://localhost:3333';
                });
        }
    </script>
</body>

</html>